{
  $schema: "https://docs.renovatebot.com/renovate-schema.json",
  extends: [
    "config:recommended",
    "helpers:pinGitHubActionDigests"
  ],
  automerge: true,
  platformAutomerge: true,
  ignoreUnstable: false,
  separateMajorMinor: false,
  dependencyDashboard: true,
  assignees: [
    "@A1994SC"
  ],
  baseBranchPatterns: [
    "main",
    "/^release\\/.*/"
  ],
  packageRules: [
    {
      matchDatasources: [
        "regex",
        "docker",
        "git-tags",
        "github-releases",
      ],
      addLabels: [
        "renovate/oci"
      ],
      groupName: "all dependencies",
      groupSlug: "all-dep",
      matchPackageNames: [
        "*"
      ],
    },
    {
      matchDatasources: [
        "custom.*"
      ],
      addLabels: [
        "renovate/oci"
      ],
      groupName: "all cilium dependencies",
      groupSlug: "all-cilium",
      matchPackageNames: [
        "*"
      ],
    },
    {
      matchManagers: ["github-actions"],
      addLabels: [
        "renovate/action"
      ],
      groupName: "all-actions",
      groupSlug: "all-actions",
      matchPackageNames: [
        "*"
      ],
    },
  ],
  customManagers: [
    {
      customType: "regex",
      description: [
        "Process custom dependencies"
      ],
      managerFilePatterns: [
        "/(^|/).+\\.ya?ml(\\.j2)?$/"
      ],
      matchStrings: [
        "(?m:renovate: datasource=(?<datasource>.+) depName=(?<depName>\\S+)( versioning=(?<versioning>\\S+))?\\n.+(version: )(?<currentValue>(.+))$)"
      ],
      versioningTemplate: "{{#if versioning}}{{{versioning}}}{{else}}semver{{/if}}",
    },
    {
      customType: "regex",
      description: [
        "Process custom dependencies"
      ],
      managerFilePatterns: [
        "/(^|/)\\.github/renovate.json(5)?$/"
      ],
      matchStrings: [
        "(?m:renovate:( versioning=(?<versioning>\\S+))?\\n\\s+defaultRegistryUrlTemplate.+?(?<currentValue>v?(?:[0-9]+\\.?){3}))"
      ],
      datasourceTemplate: "git-tags",
      depNameTemplate: "https://github.com/cilium/cilium.git",
      "versioningTemplate": "{{#if versioning}}{{{versioning}}}{{/if}}"
    },
    {
      customType: "regex",
      description: [
        "Process custom dependencies"
      ],
      datasourceTemplate: "custom.{{packageName}}",
      managerFilePatterns: [
        "/^files/airgap-images-cilium\\.txt$/"
      ],
      matchStrings: [
        "(?m:^quay.io/cilium/(?<packageName>.+):(?<currentValue>.+)$)"
      ],
      depNameTemplate: "quay.io/cilium/{{packageName}}",
      versioningTemplate: "semver",
    },
  ],
  customDatasources: {
    "cilium": {
      // renovate: versioning=regex:^v(?<major>\d+)\.(?<minor>\d+)\.(?<patch>\d+)$
      defaultRegistryUrlTemplate: "https://raw.githubusercontent.com/cilium/cilium/refs/tags/v1.19.1/install/kubernetes/cilium/values.yaml",
      format: "yaml",
      transformTemplates: [
        "({\"sourceUrl\": \"quay.io/cilium/cilium\", \"releases\": [{\"version\": image.tag}]})"
      ]
    },
    "cilium-envoy": {
      // renovate: versioning=regex:^v(?<major>\d+)\.(?<minor>\d+)\.(?<patch>\d+)$
      defaultRegistryUrlTemplate: "https://raw.githubusercontent.com/cilium/cilium/refs/tags/v1.19.1/install/kubernetes/cilium/values.yaml",
      format: "yaml",
      transformTemplates: [
        "({\"sourceUrl\": \"quay.io/cilium/cilium-envoy\", \"releases\": [{\"version\": envoy.image.tag}]})"
      ]
    },
    "hubble-relay": {
      // renovate: versioning=regex:^v(?<major>\d+)\.(?<minor>\d+)\.(?<patch>\d+)$
      defaultRegistryUrlTemplate: "https://raw.githubusercontent.com/cilium/cilium/refs/tags/v1.19.1/install/kubernetes/cilium/values.yaml",
      format: "yaml",
      transformTemplates: [
        "({\"sourceUrl\": \"quay.io/cilium/hubble-relay\", \"releases\": [{\"version\": hubble.relay.image.tag}]})"
      ]
    },
    "hubble-ui-backend": {
      // renovate: versioning=regex:^v(?<major>\d+)\.(?<minor>\d+)\.(?<patch>\d+)$
      defaultRegistryUrlTemplate: "https://raw.githubusercontent.com/cilium/cilium/refs/tags/v1.19.1/install/kubernetes/cilium/values.yaml",
      format: "yaml",
      transformTemplates: [
        "({\"sourceUrl\": \"quay.io/cilium/hubble-ui-backend\", \"releases\": [{\"version\": hubble.ui.backend.image.tag}]})"
      ]
    },
    "hubble-ui": {
      // renovate: versioning=regex:^v(?<major>\d+)\.(?<minor>\d+)\.(?<patch>\d+)$
      defaultRegistryUrlTemplate: "https://raw.githubusercontent.com/cilium/cilium/refs/tags/v1.19.1/install/kubernetes/cilium/values.yaml",
      format: "yaml",
      transformTemplates: [
        "({\"sourceUrl\": \"quay.io/cilium/hubble-ui\", \"releases\": [{\"version\": hubble.ui.frontend.image.tag}]})"
      ]
    },
    "operator-generic": {
      // renovate: versioning=regex:^v(?<major>\d+)\.(?<minor>\d+)\.(?<patch>\d+)$
      defaultRegistryUrlTemplate: "https://raw.githubusercontent.com/cilium/cilium/refs/tags/v1.19.1/install/kubernetes/cilium/values.yaml",
      format: "yaml",
      transformTemplates: [
        "({\"sourceUrl\": \"quay.io/cilium/operator-generic\", \"releases\": [{\"version\": operator.image.tag}]})"
      ]
    },
  }
}
